package com.temportalist.weepingangels.morph

import com.temportalist.weepingangels.common.WeepingAngels
import com.temportalist.weepingangels.common.extended.{AngelPlayer, AngelPlayerHandler}
import com.temportalist.weepingangels.common.lib.AngelUtility
import morph.api.Ability
import net.minecraft.entity.SharedMonsterAttributes
import net.minecraft.entity.player.EntityPlayer
import net.minecraft.nbt.NBTTagCompound
import net.minecraft.util.ResourceLocation

/**
 *
 *
 * @author TheTemportalist
 */
class AbilityQuantumLock() extends Ability() {

	private val baseMovementSpeed: Double = 0.10000000149011612D

	override def getType: String = {
		"timelock"
	}

	override def getIcon: ResourceLocation = {
		new ResourceLocation(WeepingAngels.pluginID, "textures/blocks/Plinth.png")
	}

	override def kill(): Unit = {

	}

	override def tick(): Unit = {
		this.getParent match {
			case player: EntityPlayer =>
				val isWatched: Boolean = AngelUtility.canBeSeen_Multiplayer(
					player.worldObj, player, player.boundingBox, 64D)
				val angelPlayer: AngelPlayer = AngelPlayerHandler.get(player)
				if (isWatched) {
					player.getEntityAttribute(SharedMonsterAttributes.movementSpeed)
							.setBaseValue(0.0D)
					angelPlayer.setWatched(isWatched = true)
				}
				else {
					player.getEntityAttribute(SharedMonsterAttributes.movementSpeed)
							.setBaseValue(0.4D)
					angelPlayer.setWatched(isWatched = false)
				}
			case _ =>
		}

	}

	override def postRender(): Unit = {

	}

	override def save(tag: NBTTagCompound): Unit = {

	}

	override def load(tag: NBTTagCompound): Unit = {

	}

	/**
	 * Creates a copy of this ability for use with parents.
	 * As previously stated before the ability instance used during registration is a base so it needs to be cloned for use with parents.
	 */
	override def clone: Ability = {
		new AbilityQuantumLock()
	}

}
